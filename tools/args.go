package tools

import (
	"bufio"
	"flag"
	"fmt"
	"os"
	"strings"
)

func Parse() (url, proxy, dnslog string, command, dns bool) {
	flag.StringVar(&url, "u", "", "input target url")
	flag.StringVar(&proxy, "p", "", "proxy:[http://user:pass@127.0.0.1:8080] [socks5://user:pass@127.0.0.1:8080]")
	flag.StringVar(&dnslog, "d", "", "Input DNSLOG")
	flag.BoolVar(&command, "cmd", false, "Enter Command Line")
	flag.BoolVar(&dns, "dns", false, "Use DNSlOG")

	flag.CommandLine.Usage = func() {
		fmt.Println("[+] CVE-2024-23692 Usge:")
		fmt.Println("	Help: CVE-2024-23692 -h")
		fmt.Println("	Detect target: CVE-2024-23692 -u http://127.0.0.1:8080")
		fmt.Println("	Enter command mode: CVE-2024-23692 -u http://127.0.0.1:8080 -cmd")
		fmt.Println("	DNSLOG: CVE-2024-23692 -u http://127.0.0.1:8080 -dns (use default dnslog: ceye.io)")
		fmt.Println("	DNSLOG: CVE-2024-23692 -u http://127.0.0.1:8080 -dns -d dbc.dnslog.cn")

		fmt.Println("[+] Support http and socks5 proxy:")
		fmt.Println("	-P proxy:[http://user:pass@127.0.0.1:8080] [socks5://user:pass@127.0.0.1:8080]")
		os.Exit(1)
	}

	flag.Parse()
	return
}

func PrintUsageAndExit() {
	fmt.Println("[+] CVE-2024-23692 Usage:")
	fmt.Println("	Help: CVE-2024-23692 -h")
	fmt.Println("	Detect target: CVE-2024-23692 -u http://127.0.0.1:8080")
	fmt.Println("	Enter command mode: CVE-2024-23692 -u http://127.0.0.1:8080 -cmd")
	fmt.Println("	DNSLOG: CVE-2024-23692 -u http://127.0.0.1:8080 -dns (use default dnslog: ceye.io)")
	fmt.Println("	DNSLOG: CVE-2024-23692 -u http://127.0.0.1:8080 -dns -d dbc.dnslog.cn")
}

func ReadCommand() (string, error) {
	reader := bufio.NewReader(os.Stdin)
	text, err := reader.ReadString('\n')
	if err != nil {
		return "", err
	}
	return strings.TrimSpace(text), nil
}
